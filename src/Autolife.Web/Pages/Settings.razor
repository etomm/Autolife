@page "/settings"
@using Microsoft.Extensions.Configuration
@inject IConfiguration Configuration

<PageTitle>Settings - Autolife</PageTitle>

<div class="settings-container">
    <h1>⚙️ Settings</h1>
    
    <div class="settings-section">
        <h2>AI Configuration</h2>
        <div class="form-group">
            <label for="aiProvider">AI Provider</label>
            <select id="aiProvider" class="form-control" @bind="selectedProvider">
                <option value="openai">OpenAI</option>
                <option value="azure">Azure OpenAI</option>
                <option value="local">Local Model</option>
            </select>
        </div>

        <div class="form-group">
            <label for="apiKey">API Key</label>
            <input type="password" id="apiKey" class="form-control" @bind="apiKey" placeholder="Enter your API key" />
        </div>

        <div class="form-group">
            <label for="model">Model</label>
            <input type="text" id="model" class="form-control" @bind="modelName" placeholder="gpt-4" />
        </div>
    </div>

    <div class="settings-section">
        <h2>Storage Configuration</h2>
        <div class="form-group">
            <label for="repoPath">Git Repository Path</label>
            <input type="text" id="repoPath" class="form-control" @bind="repositoryPath" placeholder="/path/to/repo" />
        </div>

        <div class="form-check">
            <input type="checkbox" class="form-check-input" id="autoCommit" @bind="autoCommit" />
            <label class="form-check-label" for="autoCommit">
                Automatically commit changes
            </label>
        </div>
    </div>

    <div class="settings-section">
        <h2>Appearance</h2>
        <div class="form-group">
            <label for="theme">Theme</label>
            <select id="theme" class="form-control" @bind="selectedTheme">
                <option value="light">Light</option>
                <option value="dark">Dark</option>
                <option value="auto">Auto</option>
            </select>
        </div>
    </div>

    <div class="settings-actions">
        <button class="btn btn-primary" @onclick="SaveSettings">Save Settings</button>
        <button class="btn btn-secondary" @onclick="ResetSettings">Reset to Defaults</button>
    </div>

    @if (!string.IsNullOrEmpty(message))
    {
        <div class="alert alert-@messageType mt-3">
            @message
        </div>
    }
</div>

@code {
    private string selectedProvider = "openai";
    private string apiKey = "";
    private string modelName = "gpt-4";
    private string repositoryPath = "";
    private bool autoCommit = true;
    private string selectedTheme = "light";
    private string message = "";
    private string messageType = "success";

    protected override void OnInitialized()
    {
        try
        {
            // Load settings from configuration
            var aiConfig = Configuration.GetSection("AI");
            selectedProvider = aiConfig["Provider"] ?? "openai";
            modelName = aiConfig["Model"] ?? "gpt-4";
            
            var storageConfig = Configuration.GetSection("Storage");
            repositoryPath = storageConfig["RepositoryPath"] ?? "";
            autoCommit = bool.Parse(storageConfig["AutoCommit"] ?? "true");
        }
        catch (Exception)
        {
            // Use default values if configuration fails
        }
    }

    private void SaveSettings()
    {
        try
        {
            // TODO: Implement actual settings persistence
            // For now, just show success message
            message = "Settings saved successfully!";
            messageType = "success";
            StateHasChanged();
        }
        catch (Exception ex)
        {
            message = $"Error saving settings: {ex.Message}";
            messageType = "danger";
            StateHasChanged();
        }
    }

    private void ResetSettings()
    {
        selectedProvider = "openai";
        apiKey = "";
        modelName = "gpt-4";
        repositoryPath = "";
        autoCommit = true;
        selectedTheme = "light";
        message = "Settings reset to defaults";
        messageType = "info";
        StateHasChanged();
    }
}

<style>
    .settings-container {
        max-width: 800px;
        margin: 0 auto;
        padding: 2rem;
    }

    .settings-section {
        background: white;
        padding: 2rem;
        border-radius: 12px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        margin-bottom: 2rem;
    }

    .settings-section h2 {
        margin-top: 0;
        color: #2c3e50;
        font-size: 1.5rem;
        margin-bottom: 1.5rem;
    }

    .form-group {
        margin-bottom: 1.5rem;
    }

    .form-group label {
        display: block;
        margin-bottom: 0.5rem;
        font-weight: 500;
        color: #555;
    }

    .settings-actions {
        display: flex;
        gap: 1rem;
    }

    .settings-actions button {
        padding: 0.75rem 2rem;
    }
</style>